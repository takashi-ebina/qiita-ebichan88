---
title: Javaでクラスの全フィールド（メンバ変数）を取得したい時に試したこと
tags:
  - Java
  - Struts
  - ApacheCommons
  - reflection
  - JavaBeans
private: false
updated_at: '2025-12-28T17:34:29+09:00'
id: 3e624d5f721884b85c30
organization_url_name: null
slide: false
ignorePublish: false
---
Javaでクラスの全フィールド（メンバ変数）を取得するために試行錯誤した過程を備忘録として残します。

## やりたいこと

下記クラスの全フィールドをIteratorで取得したい。
具体的には　**「field1、field2、field3、field4」**　が取得できること。

```java:Fields.java
public class Fields {
  
  // フィールド
  private String field1;
  private String field2;
  private String field3;
  private String field4;
  // コンストラクタ
  Fields(String field1, String field2, String field3, String field4) {
    this.field1 = field1;
    this.field2 = field2;
    this.field3 = field3;
    this.field4 = field4;
  }
  // settet,getterは省略
  // .
  // .
  // .
}
```

## 試したこと1：Apache Commonsの**PropertyUtils**及び**BeanUtils**を利用する

**PropertyUtils**及び**BeanUtils**は**JavaBeansを扱うクラス**です。[^1]
その中でもbean内の各値をMapに変換して返却する`describe(Object bean)`メソッドを利用して、

1. BeanをMapに変換
2. 変換したMapのkey値を取得（フィールド名）

という流れで全フィールドを取得してみることにしました。

[^1]: BeanUtilsの使い方に関して参考になるサイトはこちら。[Java BeanUtilsメモ(Hishidama's commons-BeanUtils Memo)](https://www.ne.jp/asahi/hishidama/home/tech/apache/commons/beanutil.html)

### 実装例

```java:Fields.java
 // PropertyUtils#describeを用いて全フィールドを取得
 public Iterator<?> getNamesForPropertyUtils() {
    try {
        // BeanをMapに変換　→　変換したMapのkey値を取得（フィールド名）
        return PropertyUtils.describe(this).keySet().iterator();
    } catch (IllegalAccessException | InvocationTargetException | NoSuchMethodException e) {
        System.out.println("フィールドの取得に失敗しました：" + e.toString());
        throw new RuntimeException(e);
    }
  }
  // BeanUtilsUtils#describeを用いて全フィールドを取得
 public Iterator<?> getNamesForBeanUtils() {
    try {
        // BeanをMapに変換　→　変換したMapのkey値を取得（フィールド名）
        return BeanUtils.describe(this).keySet().iterator();
    } catch (IllegalAccessException | InvocationTargetException | NoSuchMethodException e) {
        System.out.println("フィールドの取得に失敗しました：" + e.toString());
        throw new RuntimeException(e);
    }
  }
```

```java:FieldGet.java
package test;

import java.lang.reflect.InvocationTargetException;
import java.util.Iterator;

public class FieldGet {
  public static void main (String args[]) {

    Fields field = new Fields("フィールド1","フィールド２","フィールド３","フィールド４");
    Iterator<?> propertyUtils;
    Iterator<?> beanUtils;
    // PropertyUtils#describeを用いて全フィールドを取得
    propertyUtils = field.getNamesForPropertyUtils();
    System.out.println("--PropertyUtils利用--");
    while (propertyUtils.hasNext()) {
        System.out.println(propertyUtils.next());
    }
    // BeanUtilsUtils#describeを用いて全フィールドを取得
    beanUtils = field.getNamesForBeanUtils();
    System.out.println("--BeanUtils利用--");
    while (beanUtils.hasNext()) {
        System.out.println(beanUtils.next());
    }
  }
}
```

### 実行結果

```bash:実行結果
--PropertyUtils利用--
Field1
Field3
class
Field2
Field4
--BeanUtils利用--
Field1
Field3
class
Field2
Field4
```

Beanのフィールド名を取得することが出来ましたが、フィールド名ではない`class`が取得されたり、順番が昇順でないなど、改善の余地がありそうです。

また、何度か実行しているうちに`PropertyUtils/BeanUtils.describe(this)`の箇所で`InvocationTargetException`が発生しました。
解決方法がわからなかったため、別の方法でフィールド名を取得を検討することになりました。

```bash:実行結果(一部)
Caused by: java.lang.reflect.InvocationTargetException
  ... 1024 more
Caused by: java.lang.StackOverflowError
```

## 試したこと2：リフレクションを利用する

今思えばこれがJavaにおける正攻法だと思うのですが、メンバ変数は**リフレクションAPIでも取得できます。**[^2]
`getDeclaredFields()`を用いると、**すべてのアクセス修飾子(public、protected、デフォルト、private)のフィールドがFieldクラスの配列で取得できます。**

[^2]: [JavaのリフレクションAPIでフィールド取得](http://pppurple.hatenablog.com/entry/2016/08/01/225120)

### 実装例

```java:Fields.java
  // Class#getDeclaredFieldsを用いて全フィールドを取得
  public Iterator<?> getNamesForReflection() {
    // すべてのアクセス修飾子のフィールドを取得
    Field[] tmpField = this.getClass().getDeclaredFields();
    // Iteratorで返却するためのリストを生成
    List<String> fieldNames = new ArrayList<String>();
    for (int i = 0; i < tmpField.length; i++) {
      // getName()でフィールドを取得
      fieldNames.add(tmpField[i].getName());
    }
    return fieldNames.iterator();
  }
```

```java:FieldGet.java
package test;
import java.lang.reflect.Field;
import java.util.Iterator;

public class FieldGet {
  public static void main (String args[]) {

    Fields field = new Fields("フィールド1","フィールド２","フィールド３","フィールド４");
    Iterator<?> reflection;
    // Class#getDeclaredFieldsを用いて全フィールドを取得
    reflection = field.getNamesForReflection();
    System.out.println("--reflection利用--");
    while (reflection.hasNext()) {
        System.out.println(reflection.next());
    }
  }
}
```

#### 実行結果

```:実行結果
--reflection利用--
Field1
Field2
Field3
Field4
```

これで全フィールドを取得することができました。

## 【番外編】：StrutsのDynaActionFormで全フィールドを取得

Strutsの`DynaActionForm`でも、全フィールドを取得することができます。

1. `DynaValidatorForm`または`DynaActionForm`を継承したクラスを作成
2. `getMap`メソッドを利用して、フォームをMapに変換　→　変換したMapのkey値を取得（フィールド名）を実装する

Strutsの`DynaActionForm`には、**DynaActionFormで定義したプロパティをMap型に変換して返却**する`getMap`メソッドが存在します。
これにより[試したこと1](#試したこと1apache-commonsのpropertyutils及びbeanutilsを利用する)と同様の考え方で、全フィールドを取得することができます。

```java:StrutsDynaValidatorForm.java
package test;

import java.util.Iterator;
import org.apache.struts.validator.DynaValidatorForm;

public class StrutsDynaValidatorForm extends DynaValidatorForm {
  public Iterator getNames() {
    return getMap().keySet().iterator();
  }
}
```
