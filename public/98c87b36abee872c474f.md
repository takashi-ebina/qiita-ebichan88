---
title: System.out.printlnをハックして出力を差し替えてみた
tags:
  - Java
private: false
updated_at: '2026-01-13T03:10:11+09:00'
id: 98c87b36abee872c474f
organization_url_name: works-hi
slide: false
ignorePublish: false
---
# はじめに

今回はJavaを勉強したらまず初めに覚えるであろう`System.out.println`の出力を変更する方法について紹介します。

## そもそも出力を変更って？

そもそも`System.out.println`はコンソールに文字列を標準出力するためのメソッドです。
Javaを勉強する際に、プログラムの実行結果を確認する際に利用することが多いと思います。

```java
void main() {
  System.out.println("Hello, World!");
}
```

```bash:実行結果
Hello, World!
```

実は、printlnメソッドの動作を次のように変更することができます。

- 標準出力をコンソールではなくファイルに出力する
- 標準出力の内容を加工してから出力する

## System.out.printlnを少しだけ深掘りしてみる

変更の仕方を説明する前に、`System.out.println`を少しだけ深掘りしてみます。

`System.out.println`はJavaの標準ライブラリで提供されているメソッドです。

```java
System.out.println("Hello, World!");
```

[SystemクラスのJavaDocを参考](https://docs.oracle.com/javase/jp/25/docs/api/java.base/java/lang/System.html)に構造を簡単に説明してみると、

1. `System`クラスに存在する
2. `out`静的フィールドの参照している`PrintStream`オブジェクトの
3. `println`メソッドを呼び出している

ことになります。

言い換えると、`println`メソッドは`PrintStream`クラスに定義されているメソッドです。

### Systemクラスの静的フィールドについて

余談ですが、`System`クラスの静的フィールドには`out`含めて下記の3つが存在します。

| フィールド名 | 概要 |
| :----------- | :------------ |
| out | 標準出力ストリーム（PrintStreamオブジェクト） |
| err | 標準エラーストリーム（PrintStreamオブジェクト） |
| in | 標準入力ストリーム（InputStreamオブジェクト） |

`err`フィールドは標準エラーストリームを表しており、エラーメッセージの出力に利用されます。

```java
void main() {
  System.out.println("Success: Operation completed successfully!");
  System.err.println("Error: Something went wrong!");
}
```

例として、コマンドプロンプトで実行時、`2>`を利用して標準エラーストリームの出力先のみを`err.txt`に変更しています。

```bash:実行結果
>java App 2> err.txt
Success: Operation completed successfully!
>type err.txt
Error: Something went wrong!
```

`in`フィールドは標準入力ストリームを表しており、キーボードからの入力を受け取るために利用されます。

```java
void main() {
  @SuppressWarnings("resource")
  Scanner scanner = new Scanner(System.in);
  System.out.print("Enter your name: ");
  String name = scanner.nextLine();
  System.out.println("Hello, " + name + "!");
}

```

```bash:実行結果
Enter your name: Alice
Hello, Alice!
```

### 標準出力は差し替えられる

`System`クラスには、[setOut](https://docs.oracle.com/javase/jp/25/docs/api/java.base/java/lang/System.html#setOut(java.io.PrintStream))というメソッドがあります。

```java
System.setOut(PrintStream out)
```

このメソッドを使うことで、`System.out`の参照先（`PrintStream`オブジェクト）を変更できます。

`PrintStream`オブジェクトは標準出力の動作を定義しているので、`PrintStream`オブジェクトを差し替えることで、`System.out.println`の動作を変更できます。

## 実際に差し替えてみる

では実際に、次の2つの修正を加えた`System.out.println`を作成してみます。

- 標準出力をコンソールではなく`sample.txt`に出力する
- `println`メソッドの出力内容の先頭に現在日時を付与する

### 1.PrintStreamを継承してカスタムクラスを作成する

まずは、`PrintStream`クラスを継承してカスタムクラス（今回は`PrintStreamWrapper`）を作成します。

```java
class PrintStreamWrapper extends PrintStream {
  private static final DateTimeFormatter FORMATTER =
      DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss: ");
  public PrintStreamWrapper(OutputStream out) {
    super(out);
  }
  @Override
  public void println(String x) {
    super.println(now() + x);
  }
  private String now() {
    return LocalDateTime.now().format(FORMATTER);
  }
}
```

下記のように、カスタムクラスで`println(String)`メソッドをオーバーライドして、出力内容の先頭に現在日時を付与するようにしています。
すべての型の出力を完全に捕捉したい場合は、`println(int)`や`println(boolean)` などもオーバーライドする必要があります。

```java
  @Override
  public void println(String x) {
    super.println(now() + x);
  }
```

### 2. PrintStreamWrapperオブジェクトを生成時にOutputStreamを渡す

次に、1.で作成した`PrintStreamWrapper`オブジェクトを生成します。
オブジェクト生成時に、標準出力先を`sample.txt`にするために`FileOutputStream`オブジェクトを渡します。

```java
  // 標準出力先をsample.txtにするためのFileOutputStreamオブジェクト（追記モード）を生成
  FileOutputStream fos = new FileOutputStream("sample.txt", true);
  // PrintStreamWrapperオブジェクトを生成
  PrintStreamWrapper spw = new PrintStreamWrapper(fos);
```

### 3. System.setOutでPrintStreamWrapperオブジェクトに差し替える

最後に、`System.setOut`メソッドで`System.out`の参照先を`PrintStreamWrapper`オブジェクトに差し替えます。

```java
  System.setOut(spw);
```

### 完成コード例

```java
void main() throws FileNotFoundException {
  FileOutputStream fos = new FileOutputStream("sample.txt", true);
  PrintStreamWrapper spw = new PrintStreamWrapper(fos);
  System.setOut(spw);
  // 出力例：2026/01/12 18:17:18: Hello, World!
  System.out.println("Hello, World!");
}

class PrintStreamWrapper extends PrintStream {
  private static final DateTimeFormatter FORMATTER =
      DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss: ");
  public PrintStreamWrapper(OutputStream out) {
    super(out);
  }
  @Override
  public void println(String x) {
    super.println(now() + x);
  }
  private String now() {
    return LocalDateTime.now().format(FORMATTER);
  }
}
```

```bash:sample.txtの出力結果
2026/01/12 18:17:18: Hello, World!
```

## 補足：`IO.println` について

Java25以降では、`IO.println`メソッドが追加されています。
動作としては`System.out.println`と同様に標準出力に文字列を出力します。

`IO.println`の実装を見てみると、Object型の引数を受け取る`System.out.println`を呼び出していることがわかります。

```java
    /**
     * Writes a string representation of the specified object and then writes
     * a line separator to the standard output.
     *
     * <p> The effect is as if {@link java.io.PrintStream#println(Object) println(obj)}
     * had been called on {@code System.out}.
     *
     * @param obj the object to print, may be {@code null}
     */
    public static void println(Object obj) {
        System.out.println(obj);
    }
```

そのため、Object型の引数を受け取る`System.out.println`メソッドをオーバーライドすることで、`IO.println`の出力内容も変更できます。

```diff_java
void main() throws FileNotFoundException {
  FileOutputStream fos = new FileOutputStream("sample.txt", true);
  PrintStreamWrapper spw = new PrintStreamWrapper(fos);
  System.setOut(spw);
  // 出力例：2026/01/12 18:17:18: Hello, World!
-  System.out.println("Hello, World!");
+  IO.println("Hello, World!");
}

class PrintStreamWrapper extends PrintStream {
  private static final DateTimeFormatter FORMATTER =
      DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss: ");
  public PrintStreamWrapper(OutputStream out) {
    super(out);
  }
  @Override
-  public void println(String x) {
+  public void println(Object x) {  
    super.println(now() + x);
  }
  private String now() {
    return LocalDateTime.now().format(FORMATTER);
  }
}
```

## `println`の動作を変更する場面ある？

自分で記事を書いておいてあれですが、実務で使う場面はあまりないと思います。
そもそも、標準出力を直接利用せず、ログ出力ライブラリを利用することが多いので・・。

ただ、当時自分が2年目ぐらいの時に、おそらく同じようなやり方で`println`の動作を変えているシステムを見たことはあります。

## おわりに

今回は`System.out.println`の出力を変更する方法について紹介しました。

Java入門者がオブジェクト指向を理解しはじめたタイミングで本記事を読んでみると、面白いと感じていただけるかなと思っています。
